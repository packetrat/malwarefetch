#!/usr/bin/env python3
import requests, pandas, re, sys, getopt, os
from urllib.parse import urlparse
import requests

from urllib.parse import urlparse


inputfile = input("Enter filename containing URIs to be checked: ")  
dataset = pandas.read_csv(inputfile)
o = inputfile + '_results.csv'
opf = open( o, 'w')
for index, row in dataset.iterrows():
    url = str(row['url'])
    try:
        r = requests.get(url, allow_redirects=True)
    except OSError as e:
        print(url + " has failed")
    filename = os.path.basename(url)
    if os.path.exists(filename):
        filename = str(index) + filename
    try:
        open(filename, 'wb').write(r.content)
    except OSError as e:
        print("whoops")
        filename = "no file"
    opf.write(u"{},{}\n".format(url, filename))